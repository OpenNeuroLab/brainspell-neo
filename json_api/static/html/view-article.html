<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="https://brainspell.herokuapp.com/static/img/favicon.png">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>View Article - Brainspell v2</title>

    <!-- Bootstrap Core CSS -->
    <link href="https://brainspell.herokuapp.com/static/css/bootstrap.min.css" rel="stylesheet">

    <link href="/static/css/column.css" media="screen and (min-device-width: 800px)" rel="stylesheet">
    <link href="/static/css/view-article.css" rel="stylesheet">
    <link href="/static/css/view-article.css" rel="stylesheet">
    <script type="text/javascript" src="/static/js/definitions.js"></script>
    <script type="text/javascript" src="/static/js/brainsprite.min.js"></script>
    <link href="/static/css/select2.min.css" rel="stylesheet">
    <link href="/static/css/select2-bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="/static/js/spin.min.js"></script>


    <!-- Custom CSS -->
    <style>
    body {
        padding-top: 70px;
        /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
    }
    </style>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43071909-12', 'auto');
      ga('send', 'pageview');

    </script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="./">Brainspell</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                {% if title=="" %}
                    <li>
                        <a href="./login">Login</a>
                    </li>
                    <li>
                        <a href="./register">Register</a>
                    </li>
                {% end %}
                {% if title!="" %}
                    <li>
                        <a href="./logout">Logout</a>
                    </li>
                {% end %}
                    <li>
                        <a href="./contribute">Contribute</a>
                    </li>
                    <li>
                        <a href="https://github.com/OpenNeuroLab/brainspell-neo">GitHub</a>
                    </li>
                </ul>
                {% if title!="" %}
                    <a href="./account" class="navbar-brand navbar-right"style="font-size:1em;">Welcome {{ title }}</a>
                {% end %}
                {% if github_user %}
                <img class="navbar-brand navbar-right img-circle" src="{{github_avatar}}"/>
                <div class="navbar-brand navbar-right" style="font-size:1em;">
                  Welcome <a href="/repos">{{ github_user }}</a>, <a href="/github_logout?next=/view-article?id={{id}}">logout</a>
                </div>
                {% else %}
                <div class="navbar-brand navbar-right" style="font-size:1em;">
                  <a href="/oauth?next=view-article?id={{id}}">login with GitHub</a>

                </div>
                {% end %}
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">

        <div class="row">
            <div class="col-lg-12 text-center">
                <h1>Brainspell</h1>
                <p class="lead">An open, human-curated classification of neuroimaging literature.</p>
                {% if github_user %}
                <div id="github_collections_div">
                  <label for="id_label_multiple">
                    Add to Github Collections:
                  </label>
                  <select class="js-example-basic-multiple js-states form-control" id="github_collections" multiple="multiple"></select>
                  {% end %}
                </div>
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container -->

    <div class="container" id="articleContents" style="padding-bottom: 30px;">
    </div>

    <div class="container" style="padding-bottom: 30px;">
        <div id="experiments"></div>
    </div>

    <!-- jQuery Version 1.11.1 -->
    <script src="https://brainspell.herokuapp.com/static/js/jquery.js"></script>
    <script type="text/javascript" src="/static/js/select2.full.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="https://brainspell.herokuapp.com/static/js/bootstrap.min.js"></script>
    <link href="/static/css/location-table.css" rel="stylesheet">
    <script src="/static/js/three.min.js"></script>
    <script src="/static/js/detector.js"></script>
    <script src='/static/js/subdivision-modifier.js'></script>
    <script src="/static/js/PLYLoader.js"></script>
    <script src="/static/js/trackball-controls.js"></script>
    <script src="/static/js/brain-widget.js"></script>
    <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>

    <script>
    var opts = {
      lines: 13 // The number of lines to draw
      , length: 28 // The length of each line
      , width: 14 // The line thickness
      , radius: 42 // The radius of the inner circle
      , scale: 0.25 // Scales overall size of the spinner
      , corners: 1 // Corner roundness (0..1)
      , color: '#000' // #rgb or #rrggbb or array of colors
      , opacity: 0.25 // Opacity of the lines
      , rotate: 0 // The rotation offset
      , direction: 1 // 1: clockwise, -1: counterclockwise
      , speed: 1 // Rounds per second
      , trail: 60 // Afterglow percentage
      , fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
      , zIndex: 2e9 // The z-index (defaults to 2000000000)
      , className: 'spinner' // The CSS class to assign to the spinner
      , top: '82%' // Top position relative to parent
      , left: '50%' // Left position relative to parent
      , shadow: false // Whether to render a shadow
      , hwaccel: false // Whether to use hardware acceleration
      , position: 'absolute' // Element positioning
      }
      var target = document.getElementById('github_collections_div')
      var spinner = new Spinner(opts).spin(target);
      console.log(spinner)
      $.get("/repos?list=1&pmid={{id}}", function(data, err){
        var data = JSON.parse(data)
        var coll_names = _.map(data, function(d){return d.name.replace("brainspell-collection-","")})
        var in_collection = _.map(_.filter(data, function(d){return d.in_collection}),
                                  function(d){return d.name.replace("brainspell-collection-","")})
        $("#github_collections").select2({data: coll_names, theme: "bootstrap"});
        $("#github_collections").val(in_collection).trigger("change")
        spinner.stop(target)
        $("#github_collections").on("select2:select", function (e) {
          console.log("You want to add this pmid {{id}} to collection:", e.params.data.id)
          $.post("/add-to-collection?"+$.param({pmid: {{id}},
           collection:"brainspell-collection-"+e.params.data.id}), function(data, err){
             console.log(err)
           })

        });
        $("#github_collections").on("select2:unselect", function (e) {
          console.log("You want to remove this pmid {{id}} from collection:", e.params.data.id)
          $.post("/remove-from-collection?"+$.param({pmid: {{id}},
           collection:"brainspell-collection-"+e.params.data.id}), function(data, err){
             console.log(err)
           })
        });
      }).fail(function(response){
        console.log("response is", response.statusText)
        spinner.stop(target)
        $("#github_collections").select2({placeholder: response.statusText})
        $("#github_collections").prop("disabled", true)
      })



        function popup(elements) {
            var targets = JSON.parse(elements);
            var agreements = "";
            var disagree = "";
            var element = targets;
            if (typeof(targets) == "object") { // Specifies votes were provided
                element = targets[0];
                var votes = targets[1];
                if (votes != "NOVOTES") {
                    console.log(votes);
                    agreements = votes["up"];
                    disagree = votes["down"];
                }
            }
            value = "";
            if (definitions[element] == null) {
                value = definitions[capitalize(element)]
            }
            else {
                value = definitions[element]
            }
            var first = $("<div>", {"id":"myModal","class":"modal fade","role":"dialog"}).append(
                    $("<div>", {"class":"modal-dialog"}).append(
                        $("<div>", {"class":"modal-content"}).append(
                            $("<div>", {"class":"modal-header"}).append(
                    $("<button>", {"type":"button","class":"close","data-dismiss":"modal"})).append
                            ($("<h4>", {"class":"modal-title"}).text(element))).append(
                        $("<div>", {"class":"modal-body"}).append(
                                $("<p>").text(value)
                        ).append(
                                $("<a>", {"type":"button","class": "btn btn-default","onclick":`updateVote('${element}','up')`}).text("Agree: " + agreements)
                        ).append(
                                $("<a>", {"type":"button","class": "btn btn-default","onclick":`updateVote('${element}','down')`}).text("Disagree: " + disagree))
                        ).append(
                            $("<div>", {"class":"modal-footer"}).append(
                                $("<button>", {"type":"button","class": "btn btn-default","data-dismiss":"modal"}).text("Close"))
                        )).css("z-index","2000"));
            $("#articleContents").append(first);
            // remove the modal from the DOM on hide
            $('#myModal').on('hidden.bs.modal', function(){
                $(this).remove();
            });
        }

        function searcher() {
            $('#search').keyup(function () {
                var current_query = $('#search').val();
                if (current_query != "") {
                    $(".list-group li").hide();
                    $(".list-group li").each(function () {
                        var current_keyword = $(this).text();
                        // case insensitive search
                        if (current_keyword.toLowerCase().indexOf(current_query.toLowerCase()) >= 0) {
                            $(this).show();
                        }
                    });
                } else {
                    $(".list-group li").show();
                }
            });
        }

        function meshAdder() {
            var items = $("<ul>", {"class":"list-group"});
            for (var i = 0; i < descriptors.length; i++) {
                var temp = JSON.stringify(descriptors[i]["name"]);
                var single = $("<li>", {"class":"list-group-item"}).text(descriptors[i]["name"]).attr("onclick", "popup('" + temp + "')").attr("data-toggle", "modal").attr("data-target", "#myModal");
                items.append(single);
            }
            var descriptor = $("<div>", {"class": "container"}).append(
                $("<div>", {"class":"row"}).append(
                    $("<div>",{"id":"descriptorModal", "class":"modal fade bs-example-modal-lg","tabindex":-1,"role":"dialog","aria-labelledby":"myLargeModalLabel"}).append(
                        $("<div>",{"class":"modal-dialog modal-lg"}).append(
                            $("<div>",{"class":"modal-content"}).append(
                                $("<div>",{"id":"custom-search-input"}).append(
                                    $("<div>",{"class":"input-group col-md-12"}).append(
                                            $("<input>",{"id":"search","type":"text","class":"form-control input-lg","placeholder":"Search Descriptor"})
                                    ).append(
                                        $("<span>",{"class":"input-group-btn"}).append(
                                                $("<button>",{"class":"btn btn-info btn-lg","type":"button"}).append(
                                                        $("<i>",{"class":"glyphicon glyphicon-search"})
                                                )
                                        )
                                    )
                                ).append(items)
                            )
                        )
                    )
                )
            ).css("z-index","1999");
            $("#articleContents").append(descriptor);
            $('#descriptorModal').on('hidden.bs.modal', function(){
                $(this).remove();
            });
            searcher();
        }
        var count = 1;
        var experimentsObj;
        var $resultClone = $("<div>", {"class": "row"}).css("padding", "10px");
        $("#articleContents").append($("<p>").css("color", "#c0c0c0").text("Loading..."));
        $($.ajax({
            type: "GET",
            url: "/json/article?pmid={{id}}"
        }).complete(function(o) {
            j = o.responseText;
            console.log(j);
            obj = JSON.parse(j);
            try {
                metadata = JSON.parse(obj["metadata"].replace(/'/g, '"'))["meshHeadings"];
            } catch (err) { //Specifies a !CDATA left behind as a remnant of old database
                obj["metadata"] = obj["metadata"].slice(8,-2);
                metadata = JSON.parse(obj["metadata"].replace(/'/g, '"'))["meshHeadings"];
            }
            $("#articleContents").html("");
            $("#articleContents").append($("<h2>").text(obj["title"].replace(/\\"/g, '"').replace(/\\'/g, "'")));
            $("#articleContents").append($("<p>").css("color", "#c0c0c0").text(obj["authors"].split(",").join(", ").replace(/\\"/g, '"').replace(/\\'/g, "'")));
            $("#articleContents").append($("<p>", {"class": "make-column"}).text(obj["abstract"].replace(/\\"/g, '"').replace(/\\'/g, "'")));
            var linkParagraph = $("<p>");
            linkParagraph.append($("<a>").attr("href", "https://www.ncbi.nlm.nih.gov/pubmed/" + obj["pmid"]).text("PubMed"));

            {% if title!="" %}
            linkParagraph.append($("<span>").text(" | ")).append($("<a>").attr("href", "#!").attr("onclick", "document.location.href=getaURL('id')").text("Add Article to Docket"));
            {% end %}

            $("#articleContents").append(linkParagraph);
            var dropper = $("<div/>");
            if (metadata != undefined) {
                var metadataStr = "";
                for (var i = 0; i < metadata.length; i++) {
                    if (metadataStr != "") {
                        metadataStr = metadataStr + ", " + metadata[i]["name"];
                    }
                    else {
                        metadataStr = metadata[i]["name"];
                    }
                }
                var metadatalst = [];
                metadata = eval(metadata);
                for (var j = 0; j < metadata.length; j++) {
                    if (metadata[j]["vote"] != null) {
                        metadatalst.push([metadata[j]["name"], metadata[j]["vote"]])
                    }
                    else {
                        metadatalst.push([metadata[j]["name"], "NOVOTES"]);
                    }
                }
                // Create a modal for each term (approve or reject)

                dropper.addClass("dropdown");
                for (var i = 0; i < metadatalst.length; i++) {
                    var temp = metadatalst[i];
                    temp = JSON.stringify(temp);
                    dropper.append($("<button>").text(metadatalst[i][0]).attr("class", "dropbtn").attr("onclick", "popup('" + temp + "')").attr("data-toggle", "modal").attr("data-target", "#myModal"));
                }


                $("#articleContents").append($("<p>").css("color", "#c0c0c0").text("MeSH descriptors: "));
            }
            dropper.append($("<button>",{"data-toggle":"modal","data-target":".bs-example-modal-lg","class":"dropbtn"}).text("Add MeSH descriptor").attr("onclick","meshAdder()").css("font-weight","bold"));

            $("#articleContents").append(dropper);

            // TODO: add "action" once that endpoint is finished
            var form = $('<div>', {'id':"locations"});
            // generate experiment tables
            experimentsObj = jQuery.parseJSON(obj["experiments"].replace(/'/g, '"'));
            for (var i = 0; i < experimentsObj.length; i++) {
                if (experimentsObj[i]["locations"].length > 0) {
                    var expContainer = $("<div>", {"id": "container" + experimentsObj[i]["id"], "class": "experimentContainer"});

                    expContainer.append(experimentsTable(experimentsObj[i]["locations"], experimentsObj[i]['id'], i));
                    form.append(expContainer);
                    count++;
                }
            }
            //Generate BrainSprite Images
            // (setting display none until this does something useful)
            $("#articleContents").append("<div>" +
                    "<canvas style='max-width:100%;width:500px;display: none' id='3Dviewer'>" +
                    "<img id='spriteImg' class='hidden' src='/static/img/sprite.jpg'>" +
//                    "<img id='overlayImg' class='hidden' src='dmnSprite.png'>'" +
                    "</div>");
            startloader();


            //if(!(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))) {
            // if not on mobile
            $("body").append("<canvas id='3d' style='position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none'>");
            if (Detector.webgl) {
                renderer = new THREE.WebGLRenderer({
                    canvas: document.getElementById("3d"),
                    antialias: true, // to get smoother output
                    preserveDrawingBuffer: true, // to allow screenshot
                    alpha: true
                });
                renderer.setClearColor(0xffffff, 0);
                renderer.setPixelRatio(window.devicePixelRatio ? window.devicePixelRatio : 1);
            } else {
                console.log("ERROR: No WebGLRenderer available");
                renderer = new THREE.CanvasRenderer();
            }

            exp = experimentsObj;
            configureExperiments(experimentsObj);

            requestAnimationFrame(animate);
            //}
            // end brain widget generation

            form.append($("<div>").css("clear", "both"));

            if (experimentsObj.length > 0) {
                form.append($("<button>", {"id":"scorer","class":"btn btn-default","onclick":"submitHandler()"}).css("margin-top", "30px").text("Save Scores"));
                $("#articleContents").append(form);
            }
            $(".experimentContainer").each(function() {
                var elemID = $(this).attr("id").replace("container", "");
                if (document.getElementById(elemID) != null) {
                    var wrapper = document.createElement("div");
                    wrapper.append(document.getElementById(elemID));
                    wrapper.style.cssFloat = "left";
                    wrapper.style.styleFloat = "left";
                    wrapper.style.paddingRight = "30px";
                    document.getElementById('container' + elemID).insertBefore(
                        wrapper, document.getElementById('container' + elemID).firstChild);
                }
                $(this).append($("<div>").css("clear", "both"));
            });
    	}));

        function configureExperiments(exp) {
            $("#experiments").html("");
            for(var i=0;i<exp.length;i++)
            {
                if(exp[i].locations.length==0)
                    continue;
                var widgetElem = $('<div class="experiment" id="'+exp[i].id+'">');
                var titleElem = $("<div>", {"class": "experiment-title"}).append($("<div>", {"class": "title"}));
                widgetElem.append(titleElem);
                var captionElem = $("<div>", {"class": "experiment-caption"}).append($("<div>", {"class": "caption"}));
                widgetElem.append(captionElem);
                var table = $("<table>").append($("<tbody>").append($("<tr>").append($("<td>").append($("<div>", {"class": "metaCoords"})))));
                widgetElem.append(table);
                $("#experiments").append(widgetElem);
                addExperiment(exp[i].id, exp[i]);
            }
        }

        function experimentsTable(array, position, experimentNumber) {
            var table = $("<table>").css("position", "relative");
            table.addClass("scroller");
            table.addClass("gradient-style");
            table.append($("<caption>").text("Experiment " + position));
            var contents = $('<tbody>');
            contents.addClass("experiments-tbody");
            var header = $('<tr>');
            header.append($("<td>", {"class": "experiment-header"}).text("X"));
            header.append($("<td>", {"class": "experiment-header"}).text("Y"));
            header.append($("<td>", {"class": "experiment-header"}).text("Z"));
            header.append($("<td>", {"class": "experiment-header"}).text("Z-effective"));
            contents.append(header);
            for (var i = 0; i < array.length; i++) {
                var row = $("<tr>", {"class": "experiment-table-row"}).attr("onclick", "rowClicked(this, " + experimentNumber + ")");
                array[i] = array[i].split(",");
                var z_score = array[i][3];
                for (var j in array[i].slice(0,3)) {
                    row.append($("<td>", {"style": "height:100%;"}).dblclick(function() {
                        $(this).css("padding-top", "5px").css("padding-bottom", "5px");
                        let textInput = $("<input>").attr("type", "text").css("width", "60%").val($(this).html());
                        $(this).html("");
                        $(this).append(textInput);
                        textInput.focus();
                    }).text(array[i][j]));
                }
                if (z_score == null) {
                    row.append($("<td>").css("padding-top", "5px").css("padding-bottom", "5px").append($("<input>", {
                        "type": "number",
                        "style": "width:60%;",
                        "step": "0.01",
                        "id": "" + position + i
                    })));
                }
                else {
//                    row.append($("<td>").css("padding-top", "5px").css("padding-bottom", "5px")).text(z_score);
                    row.append($("<td>", {"style": "height:100%;"}).dblclick(function() {
                        $(this).css("padding-top", "5px").css("padding-bottom", "5px");
                        let textInput = $("<input>").attr("type", "text").css("width", "60%").val($(this).html());
                        $(this).html("");
                        $(this).append(textInput);
                        textInput.focus();
                    }).text(z_score));
                }
                contents.append(row);
            }
            contents.append($("<tr>").append($("<td>").css("width","100%").css("padding-top", "5px").css("padding-bottom", "5px").append($("<a>", {"href":"/account", "style":"width:60%;","id":"" + position + i})).text("Add a Row").css("text-align","center")));
            table.append(contents);
            return table;
        }

        function drop(element) {
            if (element.lastChild.style.display == "block") {
                element.lastChild.style.display = "none";
            } else {
                element.lastChild.style.display = "block";
            }
        }

        // Close the dropdown menu if the user clicks outside of it
        window.onclick = function(event) {
          if (!event.target.matches('.dropbtn')) {

            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        };

        // Add altered values to database
        function submitHandler() {
            console.log(getID());

            var changes = {};
            for (var t = 0; t < experimentsObj.length; t++) {
                for (var row = 0; row < experimentsObj[t]["locations"].length; row++) {
                    var table = experimentsObj[t]["id"];
                    if ($("#" + table + row).val() != "") {
                        changes["" + table +','+ row] = $("#" + table + row).val()
                    }
                }
            }
            changes = JSON.stringify(changes);
            console.log(changes);


            $.ajax({
                type: "POST",
                url: "/view-article",
                data: {
                    "dbChanges": changes,
                    "id": getID()
                }
            }).complete(function(o) {
                //console.log(o);
                location.reload();
            });
            //location.reload();
            //return true;
        }

        function getaURL(name, url) {
            if (!url) {
              url = window.location.href;
            }
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return "/save-article" + "?id=" +  decodeURIComponent(results[2].replace(/\+/g, " "));
        }
        function getID(url) {
            if (!url) {
              url = window.location.href;
            }
            name = 'id';
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        // TODO Send this information to the database, change schema to allow this
        function updateVote(topic,direction) {
            if (`{{ title }}` == "") {
                window.location.replace("/login");
            }
            var form = $("<form>", {"method":"post","action":"/view-article","id":"voterselector"});
            form.append($("<input>", {"type":"hidden","name":"topicChange","id":"topicChange","value":"" + topic}));
            form.append($("<input>", {"type":"hidden","name":"directionChange","id":"directionChange","value":"" + direction}));
            form.append($("<input>", {"type":"hidden","name":"id","id":"id","value":"" + getID()}));
            $("#articleContents").append(form);
            document.getElementById("voterselector").submit();
            console.log("SUBMITTED");
        }
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
        }
        $.getScript("https://rawgit.com/SIMEXP/brainsprite.js/master/assets/brainsprite.js");
        function startloader() {
            $(window).load(function () {
                var brain = brainsprite({
                    canvas: "3Dviewer",
                    sprite: "spriteImg",
//                    overlay: {
//                        sprite: "overlayImg",
//                        nbSlice: {"Y":79,'Z':63}
//                    },
                    flagCoordinates: true,
                    nbSlice: {"Y": 233, "Z": 189}
                });
            });
            console.log("GRAPHICS LOADED");
        }
    </script>
</body>
</html>
